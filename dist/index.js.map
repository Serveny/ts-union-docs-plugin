{"version":3,"file":"index.js","sources":["../src/docs.ts","../src/info.ts","../src/plugin.ts","../src/index.ts"],"sourcesContent":["import type * as TS from 'typescript/lib/tsserverlibrary';\nimport { TypeInfo, UnionParameterInfo } from './info';\n\nexport function addExtraDocs(\n\tts: typeof TS,\n\tquickInfo: TS.QuickInfo,\n\ttypeInfo: TypeInfo\n) {\n\tif (typeInfo.unionParams.length === 0) return;\n\ttypeInfo.unionParams.forEach((p) => addDocComment(ts, p));\n\tquickInfo.documentation = [\n\t\t...(quickInfo.documentation ?? []),\n\t\tcreateMarkdownDisplayPart(createMarkdown(typeInfo)),\n\t];\n}\n\ntype TagIdx = {\n\ttag: TS.JSDocTagInfo;\n\tidx: number;\n};\n\nexport function addExtraJSDocTagInfo(\n\tts: typeof TS,\n\tquickInfo: TS.QuickInfo,\n\ttypeInfo: TypeInfo\n) {\n\tif (typeInfo.unionParams.length === 0) return;\n\ttypeInfo.unionParams.forEach((p) => addDocComment(ts, p));\n\n\tif (!quickInfo.tags) quickInfo.tags = [];\n\n\tconst tagIdxs: TagIdx[] =\n\t\tquickInfo.tags\n\t\t\t?.map((tag, idx) => ({ tag, idx }))\n\t\t\t.filter((ti) => ti.tag.name === 'param') ?? [];\n\n\tconst newTags = [\n\t\t...(tagIdxs.length > 0\n\t\t\t? quickInfo.tags.filter((t, i) => i < tagIdxs[0].idx)\n\t\t\t: quickInfo.tags),\n\t];\n\n\tfor (const paramInfo of typeInfo.unionParams) {\n\t\tconst jsDocTag = findJsDocParamTagByName(tagIdxs, paramInfo.name);\n\t\tconst newTag = addParamTagInfo(\n\t\t\tjsDocTag?.tag ?? defaultParamJSDocTag(paramInfo.name),\n\t\t\tparamInfo\n\t\t);\n\t\tnewTags.push(newTag);\n\t}\n\n\tconst lastParamTagIdx =\n\t\ttagIdxs.length === 0 ? 0 : tagIdxs[tagIdxs.length - 1]?.idx ?? 0;\n\tif (quickInfo.tags.length - 1 > lastParamTagIdx)\n\t\tnewTags.push(...quickInfo.tags.filter((t, i) => i > lastParamTagIdx));\n\n\tquickInfo.tags = newTags;\n}\n\nfunction findJsDocParamTagByName(tags: TagIdx[], name: string): TagIdx | null {\n\tconst foundTag = tags.find(({ tag }) =>\n\t\ttag.text?.some(\n\t\t\t(textPart) =>\n\t\t\t\ttextPart.kind === 'parameterName' &&\n\t\t\t\ttextPart.text.toLowerCase() === name.toLowerCase()\n\t\t)\n\t);\n\treturn foundTag ?? null;\n}\n\nfunction defaultParamJSDocTag(name: string): TS.JSDocTagInfo {\n\treturn {\n\t\tname: 'param',\n\t\ttext: [\n\t\t\t{\n\t\t\t\tkind: 'parameterName',\n\t\t\t\ttext: name,\n\t\t\t},\n\t\t],\n\t} as TS.JSDocTagInfo;\n}\n\nfunction createMarkdownDisplayPart(mdText: string): TS.SymbolDisplayPart {\n\treturn {\n\t\ttext: mdText,\n\t\tkind: 'markdown',\n\t} as TS.SymbolDisplayPart;\n}\n\nfunction addParamTagInfo(\n\toldTag: TS.JSDocTagInfo,\n\ttypeInfo: UnionParameterInfo | undefined\n): TS.JSDocTagInfo {\n\tconst newTag: TS.JSDocTagInfo = JSON.parse(JSON.stringify(oldTag));\n\tif (!typeInfo?.docComment) return newTag;\n\tif (!newTag.text) newTag.text = [];\n\tnewTag.text!.push(\n\t\tcreateMarkdownDisplayPart(\n\t\t\ttypeInfo.docComment\n\t\t\t\t?.map((line, i) => (i > 0 ? (line = '> ' + line) : line))\n\t\t\t\t.join('\\n')\n\t\t)\n\t);\n\treturn newTag;\n}\n\nfunction addDocComment(ts: typeof TS, param: UnionParameterInfo) {\n\tfor (const node of param.entries) {\n\t\t// If the node was resolved, get the original node\n\t\tconst nodeWithDocs = (node as any).original ?? node;\n\t\tconst sourceFile = nodeWithDocs.getSourceFile();\n\t\tif (!sourceFile) continue;\n\n\t\tparam.docComment = extractJSDocsFromNode(ts, nodeWithDocs, sourceFile);\n\t}\n}\n\nfunction createMarkdown(typeInfo: TypeInfo) {\n\tconst paramBlocks = typeInfo.unionParams.map((pi) => paramMarkdown(pi));\n\treturn `\\n\n---\n### ðŸŒŸ Parameter-Details\n${paramBlocks.join('\\n')}\n---\n`;\n}\n\nfunction paramMarkdown(info: UnionParameterInfo): string {\n\tconst docs = info.docComment?.join('\\n') ?? '';\n\treturn `\\n#### ${numberEmoji(info.i + 1)} _${info.name}_ \\`${\n\t\tinfo.value\n\t}\\`\\n${docs}`;\n}\n\nfunction extractJSDocsFromNode(\n\tts: typeof TS,\n\tnode: TS.Node,\n\tsourceFile: TS.SourceFile\n): string[] {\n\tconst sourceText = sourceFile.getFullText();\n\tconst start = node.getStart();\n\tconst comment = getLeadingComment(ts, sourceText, start);\n\n\treturn comment\n\t\t? prepareJSDocText(sourceText.substring(comment.pos, comment.end))\n\t\t: [];\n}\n\nfunction getLeadingComment(\n\tts: typeof TS,\n\ttext: string,\n\tpos: number\n): TS.CommentRange | undefined {\n\tconst comments = ts.getLeadingCommentRanges(text, pos) ?? [];\n\t// jsdoc comment (has to start with /**)\n\tif (comments.length > 0 && text[comments[0].pos + 2] === '*')\n\t\treturn comments[comments.length - 1];\n\ttext = text.substring(0, pos);\n\tconst commentStart = text.lastIndexOf('/**');\n\tif (commentStart === -1) return;\n\tconst commentEnd = text.lastIndexOf('*/');\n\tif (commentEnd === -1) return;\n\tconst textBetween = text.substring(commentEnd + 2, pos);\n\tif (/[^ \\t|\\n]/.test(textBetween)) return;\n\treturn {\n\t\tpos: commentStart + 3,\n\t\tend: commentEnd,\n\t\tkind: ts.SyntaxKind.MultiLineCommentTrivia,\n\t};\n}\n\nfunction prepareJSDocText(rawComment: string): string[] {\n\treturn (\n\t\trawComment\n\t\t\t.replace('/**', '')\n\t\t\t.replace('*/', '')\n\t\t\t.split('\\n')\n\t\t\t// remove whitespace and the leading * in every line\n\t\t\t.map((line) => line.trim().replace(/^\\* ?/, ''))\n\t\t\t// make @tags cursive again\n\t\t\t.map((line) => line.replace(/@(\\w+)/g, (_, tag) => `\\n> _@${tag}_`))\n\t);\n}\n\nconst numEmjs = ['0ï¸âƒ£', '1ï¸âƒ£', '2ï¸âƒ£', '3ï¸âƒ£', '4ï¸âƒ£', '5ï¸âƒ£', '6ï¸âƒ£', '7ï¸âƒ£', '8ï¸âƒ£', '9ï¸âƒ£'];\n\nfunction numberEmoji(num: number) {\n\tif (num === 10) return 'ðŸ”Ÿ';\n\treturn [...String(num)].map((char) => numEmjs[parseInt(char, 10)]);\n}\n","import type * as TS from 'typescript/lib/tsserverlibrary';\n\n// This class holds every type information the plugin needs\nexport class TypeInfo {\n\tconstructor(public unionParams: UnionParameterInfo[]) {}\n}\n\nexport class UnionParameterInfo {\n\tconstructor(\n\t\tpublic i: number,\n\t\tpublic name: string,\n\t\t// Can be multiple nodes because different union types can have same values\n\t\tpublic entries: TS.TypeNode[],\n\t\tpublic value?: string,\n\t\tpublic docComment?: string[]\n\t) {}\n}\n\nexport class TypeInfoFactory {\n\tprivate checker!: TS.TypeChecker;\n\n\tconstructor(private ts: typeof TS, private ls: TS.LanguageService) {}\n\n\tcreate(fileName: string, position: number): TypeInfo | null {\n\t\tconst program = this.ls.getProgram();\n\t\tif (!program) return null;\n\n\t\tthis.checker = program.getTypeChecker();\n\t\tif (!this.checker) return null;\n\n\t\tconst source = program.getSourceFile(fileName);\n\t\tif (!source) return null;\n\n\t\tconst node = this.findNodeAtPos(source, position);\n\t\tif (!node) return null;\n\n\t\tconst symbol = this.checker.getSymbolAtLocation(node);\n\t\tif (!symbol) return null;\n\n\t\tconst callExpression = this.getCallExpression(node);\n\t\tif (!callExpression) return null;\n\n\t\tconst unionParams = this.getUnionParamters(callExpression);\n\t\tif (unionParams.length === 0) return null;\n\t\treturn new TypeInfo(unionParams);\n\t}\n\n\tprivate findNodeAtPos(srcFile: TS.SourceFile, pos: number): TS.Node | null {\n\t\tconst find = (node: TS.Node): TS.Node | null =>\n\t\t\tpos >= node.getStart() && pos < node.getEnd()\n\t\t\t\t? this.ts.forEachChild(node, find) || node\n\t\t\t\t: null;\n\t\treturn find(srcFile);\n\t}\n\n\tprivate getCallExpression(node: TS.Node): TS.CallExpression | null {\n\t\tif (this.ts.isCallExpression(node)) return node;\n\t\twhile (node && !this.ts.isCallExpression(node)) node = node.parent;\n\t\treturn node;\n\t}\n\n\tprivate getUnionParamters(callExpr: TS.CallExpression): UnionParameterInfo[] {\n\t\tconst paramTypes: UnionParameterInfo[] = [];\n\t\tconst signature = this.checker.getResolvedSignature(callExpr);\n\t\tif (!signature) return paramTypes;\n\n\t\tconst args = callExpr.arguments;\n\t\tconst params = signature.getParameters();\n\t\tfor (let i = 0; i < params.length; i++) {\n\t\t\tconst paramInfo = this.getUnionParamInfo(i, params[i], args[i]);\n\t\t\tif (paramInfo) paramTypes.push(paramInfo);\n\t\t}\n\n\t\treturn paramTypes;\n\t}\n\n\tprivate getUnionParamInfo(\n\t\ti: number,\n\t\tparamSymbol: TS.Symbol,\n\t\targ: TS.Expression\n\t): UnionParameterInfo | null {\n\t\tconst decl = paramSymbol.valueDeclaration;\n\t\tif (!decl || !this.ts.isParameter(decl) || !decl.type) return null;\n\n\t\tconst unionMemberNodes = this.collectUnionMemberNodes(decl.type);\n\t\tif (unionMemberNodes.length === 0) return null;\n\n\t\tconst value = this.getValue(arg);\n\t\tconst valueNodes = unionMemberNodes.filter((entry) => this.cmp(arg, entry));\n\n\t\treturn new UnionParameterInfo(i, paramSymbol.name, valueNodes, value);\n\t}\n\n\tprivate getValue(expr: TS.Expression): string {\n\t\treturn this.ts.isLiteralExpression(expr) ? expr.text : expr.getText();\n\t}\n\n\tprivate collectUnionMemberNodes(node: TS.Node): TS.TypeNode[] {\n\t\tconst ts = this.ts,\n\t\t\tchecker = this.checker;\n\n\t\t//const text = node.getFullText();\n\t\t//console.log(text);\n\n\t\tif (\n\t\t\tts.isUnionTypeNode(node) ||\n\t\t\tts.isIntersectionTypeNode(node) ||\n\t\t\tts.isHeritageClause(node)\n\t\t) {\n\t\t\treturn node.types.map((tn) => this.collectUnionMemberNodes(tn)).flat();\n\t\t}\n\n\t\tif (ts.isConditionalTypeNode(node)) {\n\t\t\treturn [\n\t\t\t\t...this.collectUnionMemberNodes(node.checkType),\n\t\t\t\t...this.collectUnionMemberNodes(node.extendsType),\n\t\t\t\t...this.collectUnionMemberNodes(node.trueType),\n\t\t\t\t...this.collectUnionMemberNodes(node.falseType),\n\t\t\t];\n\t\t}\n\n\t\tif (ts.isIndexedAccessTypeNode(node)) {\n\t\t\treturn [\n\t\t\t\t...this.collectUnionMemberNodes(node.objectType),\n\t\t\t\t...this.collectUnionMemberNodes(node.indexType),\n\t\t\t];\n\t\t}\n\n\t\tif (ts.isTypeLiteralNode(node)) {\n\t\t\treturn node.members\n\t\t\t\t.map((m) =>\n\t\t\t\t\t(m as any).type ? this.collectUnionMemberNodes((m as any).type) : []\n\t\t\t\t)\n\t\t\t\t.flat();\n\t\t}\n\n\t\tif (ts.isMappedTypeNode(node)) {\n\t\t\tconst results: TS.TypeNode[] = [];\n\t\t\tif (node.typeParameter.constraint)\n\t\t\t\tresults.push(\n\t\t\t\t\t...this.collectUnionMemberNodes(node.typeParameter.constraint)\n\t\t\t\t);\n\t\t\tif (node.type) results.push(...this.collectUnionMemberNodes(node.type));\n\t\t\treturn results;\n\t\t}\n\n\t\tif (ts.isTypeReferenceNode(node)) {\n\t\t\tconst symbol = checker.getSymbolAtLocation(node.typeName);\n\t\t\tif (!symbol) return [];\n\t\t\tconst aliasedSymbol =\n\t\t\t\tsymbol.flags & ts.SymbolFlags.Alias\n\t\t\t\t\t? checker.getAliasedSymbol(symbol)\n\t\t\t\t\t: symbol;\n\n\t\t\tconst decl = aliasedSymbol.declarations?.[0];\n\t\t\tif (!decl) return [];\n\t\t\tconst tn = ts.isTypeParameterDeclaration(decl)\n\t\t\t\t? decl.constraint ?? null\n\t\t\t\t: ts.isTypeAliasDeclaration(decl)\n\t\t\t\t? decl.type\n\t\t\t\t: null;\n\t\t\tif (!tn) return [];\n\t\t\treturn this.collectUnionMemberNodes(tn);\n\t\t}\n\n\t\tif (ts.isTypeOperatorNode(node)) {\n\t\t\tif (node.operator === ts.SyntaxKind.KeyOfKeyword) {\n\t\t\t\tconst type = checker.getTypeAtLocation(node.type);\n\t\t\t\treturn type.getProperties().map((p) => {\n\t\t\t\t\tconst decl = p.getDeclarations()?.[0];\n\t\t\t\t\tconst node = ts.factory.createLiteralTypeNode(\n\t\t\t\t\t\tts.factory.createStringLiteral(p.getName())\n\t\t\t\t\t);\n\t\t\t\t\t// little hack to get the original declaration of the keyof property\n\t\t\t\t\t// to be able to access the jsdoc of it\n\t\t\t\t\t(node as any).original = decl;\n\t\t\t\t\treturn node;\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (ts.isParenthesizedTypeNode(node)) {\n\t\t\treturn this.collectUnionMemberNodes(node.type);\n\t\t}\n\n\t\tif (ts.isArrayTypeNode(node)) {\n\t\t\treturn this.collectUnionMemberNodes(node.elementType);\n\t\t}\n\n\t\tif (ts.isTupleTypeNode(node)) {\n\t\t\treturn node.elements.map((el) => this.collectUnionMemberNodes(el)).flat();\n\t\t}\n\n\t\tif (ts.isTypeQueryNode(node)) {\n\t\t\tconst symbol = checker.getSymbolAtLocation(node.exprName);\n\t\t\tif (symbol) {\n\t\t\t\tconst decls = symbol.getDeclarations() ?? [];\n\t\t\t\treturn decls.flatMap((d) => this.collectUnionMemberNodes(d as TS.Node));\n\t\t\t}\n\t\t\treturn [];\n\t\t}\n\n\t\tif (ts.isTemplateLiteralTypeNode(node)) {\n\t\t\treturn this.buildTemplateLiteralNode(node);\n\t\t}\n\n\t\tif (ts.isLiteralTypeNode(node) || ts.isTypeNode(node)) {\n\t\t\treturn [node];\n\t\t}\n\n\t\treturn [];\n\t}\n\n\tprivate cmp(expr: TS.Expression, node: TS.TypeNode): boolean {\n\t\tconst ts = this.ts;\n\t\tif (!ts.isLiteralTypeNode(node)) return false;\n\n\t\tconst typeLiteral = node.literal;\n\n\t\t// string literals (i.e. \"hello\" and type T = \"hello\")\n\t\tif (ts.isStringLiteral(expr) && ts.isStringLiteral(typeLiteral))\n\t\t\treturn expr.text === typeLiteral.text;\n\n\t\t// numeric literals (i.e. 42 and type T = 42)\n\t\tif (ts.isNumericLiteral(expr) && ts.isNumericLiteral(typeLiteral))\n\t\t\treturn expr.text === typeLiteral.text;\n\n\t\t// BigInt literals (i.e. 100n and type T = 100n)\n\t\tif (ts.isBigIntLiteral(expr) && ts.isBigIntLiteral(typeLiteral))\n\t\t\treturn expr.text === typeLiteral.text;\n\n\t\t// booleans (compare kind of nodes)\n\t\tif (\n\t\t\t(expr.kind === ts.SyntaxKind.TrueKeyword &&\n\t\t\t\ttypeLiteral.kind === ts.SyntaxKind.TrueKeyword) ||\n\t\t\t(expr.kind === ts.SyntaxKind.FalseKeyword &&\n\t\t\t\ttypeLiteral.kind === ts.SyntaxKind.FalseKeyword)\n\t\t)\n\t\t\treturn true;\n\n\t\t// TODO: objects\n\n\t\t// null\n\t\tif (\n\t\t\texpr.kind === ts.SyntaxKind.NullKeyword &&\n\t\t\ttypeLiteral.kind === ts.SyntaxKind.NullKeyword\n\t\t)\n\t\t\treturn true;\n\n\t\t// undefined\n\t\tif (\n\t\t\texpr.kind === ts.SyntaxKind.UndefinedKeyword &&\n\t\t\ttypeLiteral.kind === ts.SyntaxKind.UndefinedKeyword\n\t\t)\n\t\t\treturn true;\n\n\t\treturn false;\n\t}\n\n\t// Creates new literal nodes with every possible content\n\tprivate buildTemplateLiteralNode(\n\t\tnode: TS.TemplateLiteralTypeNode\n\t): TS.TypeNode[] {\n\t\tconst results: TS.TypeNode[] = [];\n\n\t\t// Static part (i.e. \"[Channel\")\n\t\tconst headText = node.head.text;\n\n\t\t// Dynamic parts\n\t\tfor (const span of node.templateSpans) {\n\t\t\tconst innerTypeNodes = this.collectUnionMemberNodes(span.type);\n\t\t\tfor (const tn of innerTypeNodes) {\n\t\t\t\tif (\n\t\t\t\t\tthis.ts.isLiteralTypeNode(tn) &&\n\t\t\t\t\t(this.ts.isStringLiteral(tn.literal) ||\n\t\t\t\t\t\tthis.ts.isNumericLiteral(tn.literal))\n\t\t\t\t) {\n\t\t\t\t\tconst fullValue = headText + tn.literal.text + span.literal.text;\n\t\t\t\t\tconst literalNode = this.ts.factory.createLiteralTypeNode(\n\t\t\t\t\t\tthis.ts.factory.createStringLiteral(fullValue)\n\t\t\t\t\t);\n\n\t\t\t\t\t(literalNode as any).original = tn;\n\t\t\t\t\tresults.push(literalNode);\n\t\t\t\t} else {\n\t\t\t\t\tresults.push(...this.collectUnionMemberNodes(tn));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn results;\n\t}\n}\n","import type * as TS from 'typescript/lib/tsserverlibrary';\nimport { addExtraDocs, addExtraJSDocTagInfo } from './docs';\nimport { TypeInfoFactory } from './info';\n\nexport class UnionTypeDocsPlugin {\n\tprivate logger!: TS.server.Logger;\n\tprivate ls!: TS.LanguageService;\n\tprivate proxy!: TS.LanguageService;\n\tprivate typeInfoFactory!: TypeInfoFactory;\n\n\tconstructor(private readonly ts: typeof TS) {}\n\n\tcreate(info: TS.server.PluginCreateInfo) {\n\t\tthis.logger = info.project.projectService.logger;\n\t\tthis.ls = info.languageService;\n\t\tthis.typeInfoFactory = new TypeInfoFactory(this.ts, this.ls)!;\n\t\tthis.proxy = createLsProxy(this.ls);\n\t\tthis.proxy.getQuickInfoAtPosition = this.getQuickInfoAtPosition.bind(this);\n\t\tthis.proxy.getCompletionsAtPosition =\n\t\t\tthis.getCompletionsAtPosition.bind(this);\n\t\tthis.logger.info('[Union type docs plugin] Loaded');\n\t\treturn this.proxy;\n\t}\n\n\tprivate getQuickInfoAtPosition(fileName: string, pos: number) {\n\t\tconst quickInfo = this.ls.getQuickInfoAtPosition(fileName, pos);\n\t\tif (!quickInfo) return quickInfo;\n\n\t\tconst typeInfo = this.typeInfoFactory.create(fileName, pos);\n\t\tif (!typeInfo) return quickInfo;\n\n\t\t// addExtraDocs(this.ts, quickInfo, typeInfo);\n\t\taddExtraJSDocTagInfo(this.ts, quickInfo, typeInfo);\n\n\t\treturn quickInfo;\n\t}\n\n\tprivate getCompletionsAtPosition(\n\t\tfileName: string,\n\t\tpos: number,\n\t\topts: TS.GetCompletionsAtPositionOptions | undefined,\n\t\tfmt?: TS.FormatCodeSettings\n\t): TS.WithMetadata<TS.CompletionInfo> | undefined {\n\t\tconst cmpl = this.ls.getCompletionsAtPosition(fileName, pos, opts, fmt);\n\n\t\treturn cmpl;\n\t}\n}\n\n// Create new object with all functions of the old language service\nfunction createLsProxy(oldLs: TS.LanguageService): TS.LanguageService {\n\tconst proxy = Object.create(null) as TS.LanguageService;\n\tfor (const k of Object.keys(oldLs) as Array<keyof TS.LanguageService>) {\n\t\tconst x = oldLs[k];\n\t\t(proxy as any)[k] = typeof x === 'function' ? x.bind(oldLs) : x;\n\t}\n\treturn proxy;\n}\n","import * as ts from 'typescript/lib/tsserverlibrary';\nimport { UnionTypeDocsPlugin } from './plugin';\n\nexport = (mod: { typescript: typeof ts }) =>\n  new UnionTypeDocsPlugin(mod.typescript);\n"],"names":["node"],"mappings":"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"}